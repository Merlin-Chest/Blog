# æ³›å‹

## å‰è¨€

é˜…è¯»éƒ¨åˆ†ï¼š[Typescriptå®˜æ–¹æ‰‹å†Œ---Type Manipulationç±»å‹æ“ä½œ](https://www.typescriptlang.org/docs/handbook/2/types-from-types.html)

æ¬¢è¿åŠ å…¥[tså¯¹èµŒå­¦ä¹ ](https://github.com/cuixiaorui/study-every-day/tree/main/bet/02)ï¼Œæœ¬æ–‡ä¸ºç¬¬ä¸€å¤©å­¦ä¹ æ€»ç»“ã€‚

TypeScript çš„ç±»å‹ç³»ç»Ÿéå¸¸å¼ºå¤§ï¼Œå› ä¸ºå®ƒå…è®¸***æ ¹æ®å…¶ä»–ç±»å‹*** æ¥è¡¨è¾¾***ç±»å‹***ã€‚

## ï¼ˆä¸€ï¼‰æ³›å‹

æˆ‘å¯¹æ³›å‹çš„ç†è§£ï¼šä¸éœ€è¦ç”¨æˆ·æŒ‡å®šç‰¹å®šçš„ç±»å‹ï¼Œå¯ä»¥é€šè¿‡ç¼–ç¨‹çš„æ–¹å¼ï¼Œè®©ç¨‹åºè‡ªå·±èƒ½æ¨å¯¼å‡ºåº”è¯¥æ˜¯ä»€ä¹ˆç±»å‹ çš„**ä¸€ç§ä¸ç¡®å®šçš„ç±»å‹**ã€‚

æˆ‘ä»¬éœ€è¦çš„ï¼Œæ˜¯ä¸€ç§æ•è·å‚æ•°ç±»å‹çš„æ–¹æ³•ï¼Œä»¥ä¾¿æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒæ¥è¡¨ç¤ºè¿”å›çš„å†…å®¹ã€‚

ä¸¾ä¸€ä¸ªä¾‹å­ï¼š

```typescript
//æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªæ³›å‹Type
function identity<Type>(arg: Type): Type {
  return arg;
}
//å½“æˆ‘ä»¬è°ƒç”¨æ˜¯ä¼ å…¥Typeçš„ç±»å‹åº”è¯¥æ˜¯numberæ—¶
//ç¨‹åºä¼šè§„å®šargä»¥åŠå‡½æ•°è¿”å›çš„ç±»å‹ä¸ºnumber
let res = identity<number>(1);

//å¦‚æœä¸æ˜¾å¼åœ°æŒ‡å®šç±»å‹ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šè¿›è¡Œæ¨æ–­
let res = identity(1);
```

åœ¨Typescriptä¸­ï¼Œå…è®¸æˆ‘ä»¬å°†æ³›å‹ç±»å‹å˜é‡ä½œä¸ºæˆ‘ä»¬ä½¿ç”¨ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ•´ä¸€ä¸ªç±»å‹ï¼Œæä¾›äº†æ›´å¤§çš„æ–¹ä¾¿æ€§ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠTypeä½œä¸ºæ•°ç»„å…ƒç´ çš„ç±»å‹ï¼Œè¿”å›ä¸€ä¸ªè¯¥ç±»å‹çš„æ•°ç»„ï¼Œè€Œä¸æ˜¯è¯¥ç±»å‹ã€‚

```typescript
function loggingIdentity<Type>(arg: Array<Type>): Array<Type> {
  console.log(arg.length); // Arrayæœ‰.length,æ‰€ä»¥ä¸ä¼šæŠ¥é”™
  return arg;
}
```

### é€šç”¨ç±»å‹

æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªé€šç”¨æ¥å£ï¼ŒæŠŠè¿™ä¸ªæ³›å‹æŠ½ç¦»å‡ºæ¥ï¼Œå½¢æˆé€šç”¨ç±»å‹

```typescript
interface GenericIdentityFn {
  <Type>(arg: Type): Type;
}
 
//ä½¿Typeå¯ä»¥çœ‹æˆæ˜¯æ•´ä¸ªæ¥å£çš„å‚æ•°
//ä½¿å¾—ç±»å‹å‚æ•°å¯¹æ¥å£çš„æ‰€æœ‰å…¶ä»–æˆå‘˜å¯è§
interface GenericIdentityFn<Type> {
  (arg: Type): Type;
}

function identity<Type>(arg: Type): Type {
  return arg;
}
 
let myIdentity: GenericIdentityFn = identity;
```

### é€šç”¨ç±»

æ³›å‹ç±»å’Œæ³›å‹æ¥å£å¾ˆç›¸ä¼¼ï¼Œæ³›å‹ç±»`<>`åœ¨ç±»ååé¢çš„ ( ) ä¸­ï¼ŒåŒ…å«äº†æ³›å‹ç±»å‹çš„å‚æ•°åˆ—è¡¨

```typescript
class GenericNumber<NumType> {
  zeroValue: NumType;
  add: (x: NumType, y: NumType) => NumType;
}
```

ä½ å¯ä»¥å¯¹NumTypeä¼ å‡ºnumberæˆ–stringæˆ–è€…ä»»æ„ç±»å‹ï¼Œå°±åƒæ¥å£ä¸€æ ·ï¼Œå°†ç±»å‹å‚æ•°æ”¾åœ¨ç±»æœ¬èº«ä¸Šå¯ä»¥ç¡®ä¿ç±»çš„æ‰€æœ‰å±æ€§éƒ½ä½¿ç”¨ç›¸åŒçš„ç±»å‹ã€‚

### é€šç”¨çº¦æŸ

å½“æˆ‘ä»¬å¸Œæœ›å¯¹ç”¨æˆ·ä¼ è¿›æ¥çš„Typeæœ‰æ‰€çº¦æŸæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡extendsæ¥è¿›è¡Œçº¦æŸ

```typescript
interface Lengthwise {
  length: number;
}
 
function loggingIdentity<Type extends Lengthwise>(arg: Type): Type {
  console.log(arg.length); 
  return arg;
}

//ç±»å‹â€œnumberâ€ä¸æ»¡è¶³çº¦æŸâ€œLengthwiseâ€ã€‚
loggingIdentity<number>(3);
//ok
loggingIdentity({ length: 10, value: 3 });
```

### åœ¨é€šç”¨çº¦æŸä¸­ä½¿ç”¨ç±»å‹å‚æ•°

ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æƒ³ä»ä¸€ä¸ªç»™å®šåç§°çš„å¯¹è±¡ä¸­è·å–ä¸€ä¸ªå±æ€§ã€‚æˆ‘ä»¬æƒ³ç¡®ä¿æˆ‘ä»¬ä¸ä¼šæ„å¤–åœ°è·å–åˆ°ä¸å­˜åœ¨çš„å±æ€§ï¼Œå› æ­¤æˆ‘ä»¬å°†åœ¨ä¸¤ç§ç±»å‹ä¹‹é—´æ”¾ç½®ä¸€ä¸ªçº¦æŸã€‚

```typescript
//Key extends keyof Type 
//ä»£è¡¨ä¼ å…¥çš„keyå¿…é¡»åŒ…å«åœ¨Typeè¯´è¿”å›çš„æ‰€æœ‰keyä¹‹ä¸­
function getProperty<Type, Key extends keyof Type>(obj: Type, key: Key) {
  return obj[key];
}
 
let x = { a: 1, b: 2, c: 3, d: 4 };
 
//ok
getProperty(x, "a");
//errorï¼Œç±»å‹â€œ"m"â€çš„å‚æ•°ä¸èƒ½èµ‹ç»™ç±»å‹â€œ"a" | "b" | "c" | "d"â€çš„å‚æ•°
getProperty(x, "m");
```

### åœ¨æ³›å‹ä¸­ä½¿ç”¨ç±»ç±»å‹

```typescript
class BeeKeeper {
  hasMask: boolean = true;
}
 
class ZooKeeper {
  nametag: string = "Mikle";
}
 
class Animal {
  numLegs: number = 4;
}
 
class Bee extends Animal {
  keeper: BeeKeeper = new BeeKeeper();
}
 
class Lion extends Animal {
  keeper: ZooKeeper = new ZooKeeper();
}
 
function createInstance<A extends Animal>(c: new () => A): A {
  return new c();
}
 
createInstance(Lion).keeper.nametag;
createInstance(Bee).keeper.hasMask;
```

## ï¼ˆäºŒï¼‰Keyof ç±»å‹è¿ç®—ç¬¦

TypeScript å…è®¸æˆ‘ä»¬éå†æŸç§ç±»å‹çš„å±æ€§ï¼Œå¹¶é€šè¿‡ keyof æ“ä½œç¬¦æå–å…¶å±æ€§çš„åç§°ã€‚

```typescript
interface Person {
  name: string;
  age: number;
  location: string;
}

type K1 = keyof Person; // "name" | "age" | "location"
type K2 = keyof Person[];  // number | "length" | "push" | "concat" | ...
type K3 = keyof { [x: string]: Person };  // string | number
```

é™¤äº†æ¥å£å¤–ï¼Œkeyof ä¹Ÿå¯ä»¥ç”¨äºæ“ä½œç±»ï¼Œæ¯”å¦‚ï¼š

```typescript
class Person {
  name: string = "Semlinker";
}

let sname: keyof Person;
sname = "name";
```

è‹¥æŠŠ `sname = "name"` æ”¹ä¸º `sname = "age"` çš„è¯ï¼ŒTypeScript ç¼–è¯‘å™¨ä¼šæç¤ºä»¥ä¸‹é”™è¯¯ä¿¡æ¯ï¼š`ä¸èƒ½å°†ç±»å‹â€œ"age"â€åˆ†é…ç»™ç±»å‹â€œ"name"â€`

### å®æˆ˜åœºæ™¯

æˆ‘ä»¬å¸Œæœ›å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ªå¯¹è±¡å’Œkeyå€¼ï¼Œè¿”å›å¯¹åº”value

```typescript
function prop(obj, key) {
  return obj[key];
}
```

æˆ‘ä»¬å¸Œæœ›å®ç°è¿™æ ·å­çš„æ•ˆæœï¼Œè¯¥å‡½æ•°ç”¨äºè·å– **æŸä¸ªå¯¹è±¡ä¸­æŒ‡å®šå±æ€§çš„å±æ€§å€¼** ã€‚å› æ­¤æˆ‘ä»¬æœŸæœ›ç”¨æˆ·è¾“å…¥çš„å±æ€§æ˜¯å¯¹è±¡ä¸Šå·²å­˜åœ¨çš„å±æ€§ï¼Œé‚£ä¹ˆå¦‚ä½•é™åˆ¶å±æ€§åçš„èŒƒå›´å‘¢ï¼Ÿè¿™æ—¶æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æœ¬æ–‡çš„ä¸»è§’ `keyof` æ“ä½œç¬¦ï¼š

```typescript
function prop<T extends object, K extends keyof T>(obj: T, key: K) {
  return obj[key];
}
```

**é¦–å…ˆå®šä¹‰äº† T ç±»å‹å¹¶ä½¿ç”¨ `extends` å…³é”®å­—çº¦æŸè¯¥ç±»å‹å¿…é¡»æ˜¯ object ç±»å‹çš„å­ç±»å‹ï¼Œç„¶åä½¿ç”¨ `keyof` æ“ä½œç¬¦è·å– T ç±»å‹çš„æ‰€æœ‰é”®ï¼Œå…¶è¿”å›ç±»å‹æ˜¯è”åˆç±»å‹ï¼Œæœ€ååˆ©ç”¨ `extends` å…³é”®å­—çº¦æŸ K ç±»å‹å¿…é¡»ä¸º `keyof T` è”åˆç±»å‹çš„å­ç±»å‹ã€‚**

> æ¥æºï¼šhttp://semlinker.com/ts-keyof/

## ï¼ˆä¸‰ï¼‰Typeof ç±»å‹è¿ç®—ç¬¦

åœ¨ TypeScript ä¸­ï¼Œ`typeof` æ“ä½œç¬¦å¯ä»¥ç”¨æ¥è·å–ä¸€ä¸ªå˜é‡æˆ–å¯¹è±¡çš„ç±»å‹ã€‚

```typescript
let s = "hello";
let n: typeof s;
//n:string

const kakuqo = {
    name: "kakuqo",
    age: 30,
    address: {
      province: 'ç¦å»º',
      city: 'å¦é—¨'   
    }
}

type Kakuqo = typeof kakuqo;
/*
 type Kakuqo = {
    name: string;
    age: number;
    address: {
        province: string;
        city: string;
    };
}
*/
```

æ­¤å¤–ï¼Œ`typeof` æ“ä½œç¬¦é™¤äº†å¯ä»¥è·å–å¯¹è±¡çš„ç»“æ„ç±»å‹ä¹‹å¤–ï¼Œå®ƒä¹Ÿå¯ä»¥ç”¨æ¥è·å–å‡½æ•°å¯¹è±¡çš„ç±»å‹ï¼Œæ¯”å¦‚ï¼š

```typescript
function toArray(x: number): Array<number> {
  return [x];
}

type Func = typeof toArray; // -> (x: number) => number[]
```

> æ¥æºï¼šhttp://www.semlinker.com/ts-typeof/

## ï¼ˆå››ï¼‰ç´¢å¼•è®¿é—®ç±»å‹

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨*ç´¢å¼•è®¿é—®ç±»å‹*æ¥æŸ¥æ‰¾å¦ä¸€ç§ç±»å‹çš„ç‰¹å®šå±æ€§

```typescript
type Person = { age: number; name: string; alive: boolean };
type Age = Person["age"]; //number
type Age = Person[keyof Person]; //string | number | boolean
```

æˆ‘ä»¬å¯ä»¥é€šè¿‡ `number`è·å–æ•°ç»„ï¼ˆå…ƒç»„ï¼‰å…ƒç´ çš„ç±»å‹ï¼ˆè”åˆç±»å‹ï¼‰ï¼š

```typescript
const MyArray = [
  { name: "Alice", age: 15 },
  { name: "Bob", age: 23 },
  { name: "Eve", age: 38 },
];
 
type Person = typeof MyArray[number]; 
/*
type Person = {
    name: string;
    age: number;
}
*/
const MyArray = [
  { name: "Alice", age: 15 },
  { name: "Bob", height: "173cm" },
  { name: "Eve", age: 38 },
];

type Person = typeof MyArray[number]; 
/*
type Person = {
    name: string;
    age: number;
    height?: undefined;
} | {
    name: string;
    height: string;
    age?: undefined;
}
*/
```

åªèƒ½ç”¨ç±»å‹å˜é‡è¿›è¡Œç´¢å¼•æŸ¥æ‰¾ï¼š

```typescript
// é”™è¯¯
// const key = "age";
// type Age = Person[key];

//jså’Œtsçš„å†…å®¹ä¸èƒ½æ··ç”¨
//[]ä¸­å¾—ä½¿ç”¨ä¸€ä¸ªtypeå˜é‡
const key = "age";
type Age = Person[typeof key];
```

## ï¼ˆäº”ï¼‰æ¡ä»¶ç±»å‹

æˆ‘ä»¬å¯ä»¥æ ¹æ®ä¼ è¿›å»çš„æ³›å‹Tï¼Œé€šè¿‡é€»è¾‘åˆ¤æ–­ï¼Œå¾—åˆ°ä¸€ä¸ªçœŸå®çš„ç±»å‹:

```typescript
interface Animal {
  live(): void;
}
interface Dog extends Animal {
  woof(): void;
}

// Example1 : number
type Example1 = Dog extends Animal ? number : string;
// Example2 : string
type Example2 = RegExp extends Animal ? number : string;
```

### å‡½æ•°é‡è½½

åŒæ ·çš„ï¼Œåœ¨å‡½æ•°é‡è½½æ–¹é¢ï¼Œæ¡ä»¶ç±»å‹ä¹Ÿå‘æŒ¥äº†å¾ˆå¤§çš„ä½œç”¨ï¼š

```typescript
interface IdLabel {
  id: number /* some fields */;
}
interface NameLabel {
  name: string /* other fields */;
}

//ä¸ä½¿ç”¨æ³›å‹ï¼Œä¸å¤Ÿç®€æ´ï¼Œéœ€è¦å†™å‡ºæ‰€æœ‰æƒ…å†µ
function createLabel(id: number): IdLabel;
function createLabel(name: string): NameLabel;
function createLabel(nameOrId: string | number): IdLabel | NameLabel;
function createLabel(nameOrId: string | number): IdLabel | NameLabel {
  throw "unimplemented";
}

//æ³›å‹æ¡ä»¶åˆ¤æ–­ï¼Œå¦‚æœTæ˜¯numberé‚£ä¹ˆNameOrIdå°±æ˜¯IdLabelç±»å‹
//åä¹‹æ˜¯NameLabelç±»å‹
type NameOrId<T extends number | string> = T extends number
  ? IdLabel
  : NameLabel;

//ä»¥æ­¤ä¸ºä¾‹å­
//è¯¥å‡½æ•°æ¥å—numberæˆ–stringç±»å‹çš„å‚æ•°ï¼Œå¯¹åº”çš„è¿”å›å€¼æ˜¯IdLabelæˆ–è€…NameLabel
function createLabel<T extends number | string>(idOrName: T): NameOrId<T> {
  throw "unimplemented";
}

let a = createLabel("typescript");
let b = createLabel(2.8);
let c = createLabel(Math.random() ? "hello" : 42);

```

### æ¡ä»¶ç±»å‹çº¦æŸ

```typescript
//æˆ‘ä»¬çº¦æŸï¼šTå¿…é¡»åŒ…å«ä¸€ä¸ªåä¸ºmessageçš„å±æ€§,è¯¥ç±»å‹è¿”å›messageçš„ç±»å‹
//å…¶å®å®Œæˆäº†ä¸¤ä»¶äº‹ï¼šä¸€ä»¶äº‹æ˜¯å¯¹ä¼ å…¥Tçš„çº¦æŸï¼Œä¸€ä»¶äº‹æ˜¯å¯¹è‡ªèº«ç±»å‹çš„æ§åˆ¶
type MessageOf<T extends { message: unknown }> =? T["message"] : never;
 
interface Email {
  message: string;
}

//EmailMessageContents : string
type EmailMessageContents = MessageOf<Email>;

interface Dog {
  bark(): void;
}

//DogMessageContents : never å› ä¸ºDogæ¥å£ä¸­æœªåŒ…å«messageè¿™ä¸ªå±æ€§
type DogMessageContents = MessageOf<Dog>;

```

å¦å¤–ä¸€ä¸ªä¾‹å­ï¼Œå®ç°ä¸€ä¸‹æ‰å¹³åŒ–æ•°ç»„çš„åŠŸèƒ½

```typescript
type Flatten<T> = T extends any[] ? T[number] : T;
 
// å½“ä¼ è¿›å»æ˜¯ä¸€ä¸ªæ•°ç»„ç±»å‹æ—¶ï¼Œè¿”å›æ•°ç»„å…ƒç´ ç±»å‹
type Str = Flatten<string[]>;

// å½“ä¼ è¿›å»ä¸€ä¸ªå…ƒç´ ç±»å‹æ˜¯ï¼Œè¿”å›æœ¬èº«
type Num = Flatten<number>;
```

### åœ¨æ¡ä»¶ç±»å‹ä¸­æ¨æ–­

å¦å¤–ï¼Œtsè¿˜ç»™æˆ‘ä»¬æä¾›äº†ä¸€ç§ç”¨æ³•

```typescript
type Flatten<Type> = Type extends Array<infer Item> ? Item : Type;
```

ä½¿ç”¨ `infer` å£°æ˜æ€§åœ°å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ³›å‹ç±»å‹å˜é‡ Itemï¼Œè€Œä¸æ˜¯æŒ‡å®šå¦‚ä½•åœ¨ true åˆ†æ”¯ä¸­æ£€ç´¢ T çš„å…ƒç´ ç±»å‹ã€‚

è¿™æ ·å­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨inferç¼–å†™ä¸€äº›æœ‰ç”¨çš„ç±»å‹åˆ«åï¼Œä¾‹å¦‚ï¼Œæå–å‡½æ•°ç±»å‹ä¸­çš„è¿”å›ç±»å‹

```typescript
type GetReturnType<Type> = Type extends (...args: never[]) => infer Return
  ? Return
  : never;
```

å½“å­˜åœ¨å¤šä¸ªé‡è½½å‡½æ•°æ—¶ï¼Œå¯¹æœ€åä¸€ä¸ªå‡½æ•°è¿›è¡Œæ¨å¯¼

```typescript
declare function stringOrNum(x: string): number;
declare function stringOrNum(x: string | number): string | number;
declare function stringOrNum(x: number): string;

//T1 : string
type T1 = ReturnType<typeof stringOrNum>;
```

### åˆ†é…æ¡ä»¶ç±»å‹

```typescript
type ToArray<Type> = Type extends any ? Type[] : never;
```

æœ‰è¿™ä¹ˆä¸€ç§æƒ…å†µï¼Œå½“Typeä¼ è¿›ä¸€ä¸ªè”åˆç±»å‹ 

```typescript
type StrArrOrNumArr = ToArray<string | number>;
```

`StrArrOrNumArr` å¾—åˆ°çš„ç»“æœæ˜¯ string[] | number[]

å¦‚æœæˆ‘ä»¬æƒ³å˜æˆ (string | number)[] ç±»å‹ï¼Œå¯ä»¥ç”¨æ–¹æ‹¬å·å°† extends å…³é”®å­—çš„æ¯ä¸€è¾¹åŒ…å›´èµ·æ¥ã€‚

```typescript
type ToArrayNonDist<Type> = [Type] extends [any] ? Type[] : never;

//StrArrOrNumArr : (string | number)[]
type StrArrOrNumArr = ToArrayNonDist<string | number>;
```

## ï¼ˆå…­ï¼‰æ˜ å°„ç±»å‹

æœ‰æ—¶å€™æˆ‘ä»¬ä¸å¸Œæœ›è¿”å›æœ¬èº«ï¼Œæœ‰æ—¶å€™å¸Œæœ›å¯ä»¥æ”¹å˜æˆä¸ºä¸€ç§ç±»å‹ã€‚

æ˜ å°„ç±»å‹æ˜¯ä¸€ç§æ³›å‹ç±»å‹ï¼Œå®ƒä½¿ç”¨ PropertyKeys (é€šå¸¸é€šè¿‡ keyof åˆ›å»º)çš„è”åˆæ¥è¿­ä»£é”®ä»¥åˆ›å»ºç±»å‹:

```typescript
type OptionsFlags<Type> = {
  [Property in keyof Type]: boolean;
};

type FeatureFlags = {
  darkMode: () => void;
  newUserProfile: () => void;
};

//å°†æ‰€æœ‰å±æ€§å‡å˜ä¸ºbooleanç±»å‹
type FeatureOptions = OptionsFlags<FeatureFlags>;
/*
type FeatureOptions = {
    darkMode: boolean;
    newUserProfile: boolean;
}
*/
```

### æ˜ å°„ä¿®é¥°ç¬¦

åœ¨æ˜ å°„è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªé¢å¤–çš„ä¿®é¥°ç¬¦: `readonly` å’Œ`?` ï¼Œå®ƒä»¬åˆ†åˆ«å½±å“å¯å˜æ€§å’Œå¯é€‰æ€§ã€‚

å¦å¤–ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ `-` æˆ– `+` ä½œä¸ºå‰ç¼€æ¥åˆ é™¤æˆ–æ·»åŠ è¿™äº›ä¿®é¥°ç¬¦ã€‚å¦‚æœæ²¡æœ‰æ·»åŠ å‰ç¼€ï¼Œåˆ™å‡å®šä¸º + ã€‚

```typescript
//å»é™¤readonly
type CreateMutable<Type> = {
  -readonly [Property in keyof Type]: Type[Property];
};

type LockedAccount = {
  readonly id: string;
  readonly name: string;
};

type UnlockedAccount = CreateMutable<LockedAccount>;
/*
UnlockedAccount : {
    id: string;
    name: string;
}
*/
```

```typescript
//å»é™¤å¯é€‰æ€§è´¨
type Concrete<Type> = {
  [Property in keyof Type]-?: Type[Property];
};
 
type MaybeUser = {
  id: string;
  name?: string;
  age?: number;
};
 
type User = Concrete<MaybeUser>;
/*
  type User = {
      id: string;
      name: string;
      age: number;
  }
*/
```

### ä½¿ç”¨aså¯¹Keyé‡æ–°æ˜ å°„

å¯ä»¥ä½¿ç”¨æ˜ å°„ç±»å‹ä¸­çš„ as å­å¥é‡æ–°æ˜ å°„æ˜ å°„ç±»å‹çš„é”®ï¼Œä¾‹å¦‚å¯¹keyçš„åç§°è¿›è¡Œæ›´æ”¹ï¼š

```typescript
//æ³¨æ„ä½¿ç”¨åå¼•å·
type Getters<Type> = {
    [Property in keyof Type as /`get${Capitalize<string & Property>}/`]: () => Type[Property]
};

interface Person {
    name: string;
    age: number;
    location: string;
}
 
type LazyPerson = Getters<Person>;
/*    
type LazyPerson = {
    getName: () => string;
    getAge: () => number;
    getLocation: () => string;
}
*/
```

å¦ä¸€ä¸ªä¾‹å­

```typescript
//æŒ‡å®šTypeä¸­å±æ€§kindçš„å€¼ä½œä¸ºæ–°çš„å±æ€§å
type EventConfig<Events extends { kind: string }> = {
    [E in Events as E["kind"]]: (event: E) => void;
}
 
type SquareEvent = { kind: "square", x: number, y: number };
type CircleEvent = { kind: "circle", radius: number };
 
type Config = EventConfig<SquareEvent | CircleEvent>
/*
type Config = {
    square: (event: SquareEvent) => void;
    circle: (event: CircleEvent) => void;
}
*/
```

## ï¼ˆä¸ƒï¼‰æ¨¡æ¿æ–‡å­—ç±»å‹

æ¨¡æ¿æ–‡å­—ç±»å‹å»ºç«‹åœ¨å­—ç¬¦ä¸²æ–‡å­—ç±»å‹ä¹‹ä¸Šï¼Œå¹¶ä¸”èƒ½å¤Ÿé€šè¿‡è”åˆæ‰©å±•æˆè®¸å¤šå­—ç¬¦ä¸²ã€‚

ä¸ JavaScript ä¸­çš„æ¨¡æ¿å­—ç¬¦ä¸²å…·æœ‰ç›¸åŒçš„è¯­æ³•ï¼Œä½†æ˜¯ç”¨äºç±»å‹ä½ç½®ã€‚å½“ä¸å…·ä½“æ–‡æœ¬ç±»å‹ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œæ¨¡æ¿æ–‡æœ¬é€šè¿‡è¿æ¥å†…å®¹ç”Ÿæˆä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²æ–‡æœ¬ç±»å‹ã€‚

```typescript
type EmailLocaleIDs = "welcome_email" | "email_heading";
type FooterLocaleIDs = "footer_title" | "footer_sendoff";
 
//type AllLocaleIDs = "welcome_email_id" | "email_heading_id" | "footer_title_id" | "footer_sendoff_id"
type AllLocaleIDs = `${EmailLocaleIDs | FooterLocaleIDs}_id`;


//å¯¹äºæ¨¡æ¿æ–‡å­—ä¸­çš„æ¯ä¸ªæ’å€¼ä½ç½®ï¼Œè”åˆæ˜¯åå­—ä¹˜:
type Lang = "en" | "ja" | "pt";

//type LocaleMessageIDs = "en_welcome_email_id" | "en_email_heading_id" | "en_footer_title_id" | "en_footer_sendoff_id" | "ja_welcome_email_id" | "ja_email_heading_id" | "ja_footer_title_id" | "ja_footer_sendoff_id" | "pt_welcome_email_id" | "pt_email_heading_id" | "pt_footer_title_id" | "pt_footer_sendoff_id"
type LocaleMessageIDs = `${Lang}_${AllLocaleIDs}`;
```

### ç±»å‹å­—ç¬¦ä¸²è”åˆ

å°†å­—ç¬¦ä¸²å’Œç±»å‹è¿›è¡Œè”åˆä½¿ç”¨ï¼Œå°†ç¢°æ’å‡ºä¸ä¸€æ ·çš„ç«èŠ±ã€‚

```typescript
//è¯¥ç±»å‹å­˜åœ¨ä¸€ä¸ªonæ–¹æ³•ï¼Œåç§°ä¸ºæ¯ä¸€ä¸ªå±æ€§å+Changed
type PropEventSource<Type> = {
  on(
    eventName: `${string & keyof Type}Changed`,
    callback: (newValue: Type[Key]) => void
  ): void;
};

//æˆ‘ä»¬å£°æ˜ä¸€ä¸ªæ–¹æ³•ï¼Œå°†åŸç±»å‹å’Œä¸Šé¢çš„ç±»å‹åˆå¹¶(&)èµ·æ¥
declare function makeWatchedObject<Type>(
  obj: Type
): Type & PropEventSource<Type>;

//åˆ›å»ºä¸€ä¸ªå®ä¾‹
const person = makeWatchedObject({
  firstName: "Saoirse",
  lastName: "Ronan",
  age: 26
});

person.on("firstNameChanged", () => {});
```

è¿™æ ·å­æˆ‘ä»¬å¯ä»¥åœ¨ä½¿ç”¨æ—¶ï¼Œç»™äºˆæˆ‘ä»¬ä»£ç æç¤ºï¼Œè¿™æ˜¯æˆ‘ä»¬å¸Œæœ›çš„ã€‚

![image-20211120162107337](https://i.loli.net/2021/11/20/F8GZalAYSvCUWOV.png)

![image-20211120162126468](https://i.loli.net/2021/11/20/7M6UJLVSpY4HgkN.png)

### å†…éƒ¨å­—ç¬¦ä¸²æ“ä½œç±»å‹

```typescript
Uppercase<StringType> //è½¬å¤§å†™
Lowercase<StringType> //è½¬å°å†™
Capitalize<StringType> //é¦–å­—æ¯å¤§å†™
Uncapitalize<StringType>//é¦–å­—æ¯å°å†™
```

è‡³æ­¤ï¼Œè¿™éƒ¨åˆ†çš„å†…å®¹å°±å­¦å®Œå•¦~å¯ä»¥æ‘¸ä¼šé±¼äº†ã€‚



æŒç»­æ›´æ–°ä¸­ï½æ¬¢è¿å…³æ³¨æˆ‘çš„æ˜é‡‘å’Œgithubï¼Œè§‰å¾—ä¸é”™çš„è¯ï¼Œè®°å¾—ç»™æˆ‘çš„é¡¹ç›®ğŸŒŸ ä¸€ä¸‹å“¦ï½
