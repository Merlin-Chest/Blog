# åŸå‹

## èƒŒæ™¯çŸ¥è¯†

åœ¨åŸºäºç±»çš„ä¼ ç»Ÿé¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå¯¹è±¡ç”±ç±»å®ä¾‹åŒ–è€Œæ¥ï¼Œå®ä¾‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œç±»çš„å±æ€§å’Œæ–¹æ³•ä¼šæ‹·è´åˆ°è¿™ä¸ªå¯¹è±¡ä¸­ï¼›å¯¹è±¡çš„ç»§æ‰¿å®é™…ä¸Šæ˜¯ç±»çš„ç»§æ‰¿ï¼Œåœ¨å®šä¹‰å­ç±»ç»§æ‰¿äºçˆ¶ç±»æ—¶ï¼Œå­ç±»ä¼šå°†çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•æ‹·è´åˆ°è‡ªèº«å½“ä¸­ã€‚å› æ­¤ï¼Œè¿™ç±»è¯­è¨€ä¸­ï¼Œå¯¹è±¡åˆ›å»ºå’Œç»§æ‰¿è¡Œä¸ºéƒ½æ˜¯é€šè¿‡æ‹·è´å®Œæˆçš„ã€‚

**ä½†åœ¨JavaScriptï¼Œå®ƒæ˜¯æ²¡æœ‰`ç±»`çš„æ¦‚å¿µçš„ï¼æ²¡æœ‰ç±»ï¼æ²¡æœ‰ç±»ï¼**

**å¯¹è±¡çš„â€œç»§æ‰¿â€å¹¶æ˜¯ä¸å­˜åœ¨æ‹·è´è¡Œä¸ºçš„ï¼Œè€Œæ˜¯ä¸€ç§å¯¹è±¡é—´çš„åŸå‹å¼•ç”¨å…³ç³»`(åœ¨å°é»„ä¹¦ä¸­æŠŠå…¶å«åšè¡Œä¸ºå§”æ‰˜)`ã€‚**

> ES6 ä¸­çš„classä¹Ÿåªä¸è¿‡æ˜¯è¯­æ³•ğŸ¬ ï¼Œæœ¬è´¨è¿˜æ˜¯å»ºç«‹åœ¨ [[prototype]] æœºåˆ¶ä¸Šï¼Œå¹¶éçœŸæ­£æ„ä¹‰ä¸Šçš„ç±»ã€‚
> 
> **æƒ³å¿…ä½ ä»¬éƒ½è¢«å®ƒéª—äº†å§ï¼Ÿåå¾—å¾ˆï¼**

## å…ˆæ¥è®¤è¯†ä¸€ä¸‹å¯¹è±¡å’Œå‡½æ•°

åœ¨JavaScriptä¸­ï¼Œå¯¹è±¡åˆ†ä¸ºæ™®é€šå¯¹è±¡å’Œå‡½æ•°å¯¹è±¡ã€‚

æˆ‘ä»¬å…ˆåˆ†åˆ«æ¥çœ‹çœ‹ä¸€ä¸ªæ™®é€šå¯¹è±¡/å‡½æ•°é‡Œæœ‰ä»€ä¹ˆï¼Œåœ¨æµè§ˆå™¨ä¸‹æ‰§è¡Œä»¥ä¸‹çš„ä»£ç ï¼š

```javascript
let obj = {}
console.dir(obj)
console.log("obj çš„ç±»å‹"+typeof obj);
function Fn() {}
console.dir(Fn)
console.log('Fn çš„ç±»å‹' + typeof Fn);
```

è¿è¡Œç»“æœå¦‚ä¸‹ï¼š

![2021-12-16-01-05-02-image](https://cdn.jsdelivr.net/gh/Merlin218/image-storage@master/20211217/2021-12-16-01-05-02-image.6lu1vii4a3c0.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š

- å¯¹äºä¸€ä¸ªæ™®é€šå¯¹è±¡æ¥è¯´ï¼Œéšå«ç€ä¸€ä¸ªå±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸º `åŸå‹é“¾[[prototype]]`çš„ä¸€ä¸ªèŠ‚ç‚¹ ã€‚
	- å¯¹è±¡æ›´æ·±å…¥çš„è®¤è¯†ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼Œå°±ä¸åœ¨æœ¬æ–‡è¿›è¡Œæ¢è®¨ã€‚
		- æ–‡ç« é“¾æ¥ï¼š[ã€Œä½ å¿…é¡»çŸ¥é“çš„JavaScriptã€æ‰¾å¯¹è±¡ä¹‹å‰ï¼Œå…ˆæŠŠâ€œå¯¹è±¡â€œäº†è§£æ¸…æ¥šå§](https://juejin.cn/post/7042261962775855135)
	
  - åŸå‹é“¾å…¶å®æ²¡æœ‰ä»€ä¹ˆç¥ç§˜çš„ï¼Œä»–æœ¬è´¨å°±æ˜¯`å¯¹å…¶ä»–å¯¹è±¡çš„å¼•ç”¨`ã€‚
  - å½“åœ¨åŸæœ¬çš„å¯¹è±¡ä¸­æ‰¾ä¸åˆ°å±æ€§æ—¶ï¼Œå°±å¾€å¼•ç”¨çš„å…¶ä»–å¯¹è±¡é‡Œé¢æ‰¾ã€‚
  - æ‰€æœ‰æ™®é€šçš„åŸå‹é“¾éƒ½ä¼šæŒ‡å‘å†…ç½®çš„`Object.prototype`ï¼Œæ‰€ä»¥è¿™ä¸ª`Object.prototype`å¯¹è±¡é‡Œ,åŒ…å«ç€JavaScriptä¸­è®¸å¤šå¸¸ç”¨çš„åŠŸèƒ½ã€‚è€Œè¿™ä¸ªå¯¹è±¡çš„åŸå‹é“¾çš„å°½å¤´åˆ™æ˜¯æŒ‡å‘`null`ã€‚

> å¤§å¤šæ•°æµè§ˆå™¨æ”¯æŒä½¿ç”¨`__proto__` æ¥è·å–`[[prototype]]`ï¼Œ`__proto__` çš„è¯»å–å™¨(getter)æš´éœ²äº†ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨ `[[Prototype]]` ï¼Œä½†è¯¥ç‰¹æ€§å·²ç»ä» Web æ ‡å‡†ä¸­åˆ é™¤ï¼Œè™½ç„¶ä¸€äº›æµè§ˆå™¨ç›®å‰ä»ç„¶æ”¯æŒå®ƒï¼Œä½†ä¹Ÿè®¸ä¼šåœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´åœæ­¢æ”¯æŒï¼Œè¯·å°½é‡ä¸è¦ä½¿ç”¨è¯¥ç‰¹æ€§ï¼Œåœ¨åç»­çš„ESæ ‡å‡†ä¸­ï¼Œæä¾›ç›¸å…³çš„APIå¯ä»¥ä½¿ç”¨ã€‚

- å¯¹ä¸€ä¸ªå‡½æ•°æ¥è¯´ï¼Œå®ƒå…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒåŒºåˆ«äºæ™®é€šå¯¹è±¡æ¥è¯´ï¼Œæœ€ä¸»è¦çš„åŒºåˆ«æ˜¯å¤šäº†ä¸€ä¸ª`prototype` å±æ€§ï¼Œç§°ä¸º`åŸå‹`ï¼ŒåŸå‹çš„ä½œç”¨å°±æ˜¯å…±äº«æ–¹æ³•ã€‚
  - é‡Œé¢ä¸€ä¸ªé»˜è®¤çš„`constructor` å±æ€§ï¼Œç”¨äºè®°å½•å®ä¾‹æ˜¯ç”±å“ªä¸ªå‡½æ•°åˆ›å»ºï¼›
  - å½“è¯¥å‡½æ•°è¢«newä¸€ä¸ªå®ä¾‹æ—¶ï¼Œå®ä¾‹å¯¹è±¡çš„åŸå‹é“¾åˆ™æŒ‡å‘å®ƒï¼Œæ‰€ä»¥æˆ‘ä»¬å¯èƒ½ä¼šåœ¨å‡½æ•°çš„prototypeä¸­å®šä¹‰æ‰€è°“å…¬å…±æ–¹æ³•ã€‚

> newä¹Ÿæ˜¯ä¸€ä¸ªè¯­æ³•ğŸ¬ ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä¹Ÿæè¿°äº†å®ƒçš„æ‰§è¡Œè¿‡ç¨‹ã€‚
> 
> [ã€Œä½ å¿…é¡»çŸ¥é“çš„JavaScriptã€åˆ°åº•â€œè¿™â€æ˜¯ä»€ä¹ˆå•Š - æ˜é‡‘](https://juejin.cn/post/7040707728599154695)

## å±æ€§è®¾ç½®å’Œå±è”½

åœ¨ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬æåˆ°äº†[[Put]]ï¼Œæˆ‘ä»¬æ¥è®²è®²å½“åŸå¯¹è±¡ä¸å­˜åœ¨è¯¥å±æ€§æ—¶ï¼Œ[[Put]]è¿›è¡Œçš„æ“ä½œï¼š

- éå†åŸå‹é“¾ï¼Œå¦‚æœè¿˜æ˜¯æ‰¾ä¸åˆ°åŒåå±æ€§ï¼Œé‚£ä¹ˆç›´æ¥åœ¨è¯¥å¯¹è±¡ä¸­æ·»åŠ è¯¥å±æ€§

- å¦‚æœåœ¨åŸå‹é“¾ä¸Šèƒ½æ‰¾åˆ°è¯¥å±æ€§å‘¢ï¼Œåˆ™ä¼šè¿›è¡Œä¸‹é¢çš„åˆ¤æ–­ï¼š
  
  - å¦‚æœè¯¥å±æ€§æ²¡æœ‰è¢«æ ‡è®°ä¸ºåªè¯»ï¼ˆ`writable:false`ï¼‰ï¼Œé‚£ä¹ˆç›´æ¥æ·»åŠ åˆ°å¯¹è±¡æœ¬èº«
  
  - å¦‚æœè¯¥å±æ€§è¢«æ ‡è®°ä¸ºåªè¯»ï¼ˆ`writable:false`ï¼‰ï¼Œé‚£ä¹ˆå¿½ç•¥è¯¥è¯­å¥ï¼Œä¸ä¼šå‘ç”Ÿå±è”½ã€‚åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šæŠ¥é”™
  
  - å¦‚æœè¯¥å±æ€§æ˜¯ä¸€ä¸ªsetterï¼Œé‚£ä¹ˆä¼šè°ƒç”¨è¿™ä¸ªsetterï¼Œä¸ä¼šå‘ç”Ÿå±è”½ï¼Œä¹Ÿä¸ä¼šé‡æ–°å®šä¹‰ã€‚

## newä¸€ä¸ªå‡½æ•°

åœ¨JavaScriptä¸­ï¼Œæˆ‘ä»¬æŠŠå¸¦newçš„å‡½æ•°è°ƒç”¨ï¼Œç§°ä¹‹ä¸º`æ„é€ å‡½æ•°è°ƒç”¨`ï¼›å½“æˆ‘ä»¬ä½¿ç”¨newæ—¶ï¼Œåœ¨è¿™è¿‡ç¨‹ä¸­ä¼šæ‰§è¡Œ[[prototype]]é“¾çš„é“¾æ¥ã€‚æˆ‘ä»¬æ¥è¯•è¯•ï¼š

```javascript
function Bird() {
  console.log('Bird');
}
console.dir(Bird)
let bird = new Bird();
console.dir(bird);
```


æˆ‘ä»¬ä¼šå‘ç°ï¼ŒåŸå‹é“¾ä¸Šçš„constructoræŒ‡å‘Bird()ï¼Œé‚£ä¹ˆæœ‰äººä¼šè®¤ä¸ºbirdç”±Birdæ„é€ ï¼Œå› ä¸ºconstructoræŒ‡å‘Birdã€‚

å¯å½“æˆ‘æŠŠBirdçš„prototypeä¿®æ”¹äº†ï¼Œå®ä¾‹åŒ–å¯¹è±¡ä¼šæœ‰ä»€ä¹ˆå˜åŒ–

```javascript
function Bird() {
  console.log('Bird');
}
Bird.prototype = {};

let bird = new Bird();
console.dir(bird);
```


é€šè¿‡è¿™ä¸¤å¼ å›¾ï¼Œæˆ‘ä»¬éªŒè¯äº†birdå®ä¾‹çš„åŸå‹é“¾æŒ‡å‘å…¶â€œæ„é€ å‡½æ•°â€çš„prototypeä¸Šã€‚

åŒæ—¶ï¼Œæˆ‘ä»¬ä¹ŸçŸ¥é“prototypeä¸Šçš„constructoré»˜è®¤æŒ‡å‘è¯¥å‡½æ•°ï¼Œä½†prototypeæ˜¯å¯å˜çš„ï¼Œå½“æˆ‘ä»¬å¯¹å…¶è¿›è¡Œæ”¹å˜ï¼Œè¡¨é¢ä¸Šbirdè¿˜æ˜¯Birdæ„é€ çš„ï¼Œä½†æ˜¯bird.constructorå¹¶éæŒ‡å‘Birdï¼Œè€Œæ˜¯Objectã€‚ï¼ˆäº‹å®ä¸Šé»˜è®¤çš„constructorå·²ç»è¢«æ‘§æ¯ï¼Œå½“å‰æŒ‡å‘çš„æ˜¯ åŸå‹é“¾ä¸Šä¸€å±‚çš„constructorï¼‰

å› æ­¤ï¼Œ**é constructoræ¥åˆ¤æ–­å…¶ç”±è°æ„é€ æ˜¯ä¸å¯å–çš„ï¼** æˆ‘ä»¬ä¹Ÿå¯ä»¥ç†è§£åˆ°ï¼Œåœ¨JavaScriptä¸­å¹¶æ²¡æœ‰æ„é€ å‡½æ•°å¯è¨€ï¼Œå› ä¸º`new`å‡½æ•°è°ƒç”¨å°±å˜æˆä¸€ä¸ªæ„é€ å‡½æ•°è°ƒç”¨ã€‚

> ä¸€èˆ¬æ¥è¯´ï¼Œæ˜¯ä¸å…è®¸ç›´æ¥æ”¹å˜åŸå‹prototypeçš„æŒ‡å‘ã€‚
> 
> åœ¨ES6ä¸­ï¼Œæä¾›`Object.setPrototypeOf()`æ¥ä¿®æ”¹å…³è”ã€‚

### ä¾‹é¢˜

```js
// a
function Foo () {
 getName = function () {
   console.log(1);
 }
 return this;
}
// b
Foo.getName = function () {
 console.log(2);
}
// c
Foo.prototype.getName = function () {
 console.log(3);
}
// d
var getName = function () {
 console.log(4);
}
// e
function getName () {
 console.log(5);
}

Foo.getName();           // 2
getName();               // 4
Foo().getName();         // 1
getName();               // 1 
new Foo.getName();       // 2
new Foo().getName();     // 3
new new Foo().getName(); // 3
```

## ç±»æ€æƒ³ä¸­çš„ç»§æ‰¿

åœ¨ES6ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°+åŸå‹å¯¹è±¡æ¨¡æ‹Ÿå®ç°ã€‚

```javascript
function Father(name) {
    this.name = name;
}
Father.prototype.dance = function () {
    return 'dance';
};
function Son(name, age) {
    Father.call(this, name);
    this.age = age;
}
let son = new Son('merlin', 100);
son.dance();   //æŠ¥é”™
```

å¦‚ä½•ç»§æ‰¿çˆ¶ç±»çš„æ–¹æ³•å‘¢ï¼Ÿ

å¦‚æœä½¿ç”¨`Son.prototype = Father.prototype`ï¼Œæˆ‘ä»¬çŸ¥é“ï¼ŒåŸå‹æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨=æ“ä½œç¬¦å®é™…ä¸Šæ˜¯å¼•ç”¨å…³ç³»è€Œä¸æ˜¯å¤åˆ¶ã€‚å› æ­¤å¦‚æœæˆ‘ä»¬ä¿®æ”¹å­ç±»çš„åŸå‹æ–¹æ³•ï¼Œçˆ¶ç±»çš„åŸå‹åŒæ ·ä¼šå—åˆ°å½±å“ã€‚

å› æ­¤æˆ‘ä»¬å¯ä»¥å°†å­ç±»çš„åŸå‹æŒ‡å‘çˆ¶ç±»çš„å®ä¾‹ï¼Œä¼šç”Ÿæˆä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¹¶ä¸”åŸå‹é“¾ä¼šæŒ‡å‘çˆ¶ç±»çš„åŸå‹ï¼Œè¿™æ ·å­æ—¢å¯ä»¥å…±äº«çˆ¶ç±»çš„æ–¹æ³•ï¼Œä¸ºå­ç±»å¢åŠ æ–¹æ³•ï¼Œçˆ¶ç±»ä¹Ÿä¸ä¼šå—å½±å“ã€‚

```javascript
Son.prototype = new Father();
Son.prototype.singAndDance = function () {
  console.log(this.name + ' sing and' + this.dance());
};
```

ES6ä¹‹åï¼Œå¼•å…¥Classè¯­æ³•ğŸ¬ ï¼Œä½¿ä»£ç æ›´å…·å¤‡å¯è¯»æ€§ã€‚

> classçš„å¼•å…¥ï¼Œåªæ˜¯æ‘’å¼ƒäº†ä¹‹å‰é‚£ç§ä¸‘é™‹çš„è¯­æ³•ï¼Œå…¶æœ¬è´¨ä¸Šè¿˜æ˜¯é€šè¿‡[[prototype]]æœºåˆ¶å®ç°çš„ã€‚å®ç°è¿˜æ˜¯â€œç±»â€çš„æ€æƒ³ã€‚

```javascript
class Father {
  constructor(name) {
    this.name = name;
  }
  dance() {
    return 'dancing';
  }
}
class Son extends Father {
  constructor(name, score) {
    super(name);
    this.score = score;
  }
  singAndDance() {
    console.log(this.name + ' sing and' + this.dance());
  }
}
```

> - classå¿…é¡»è¢«newè°ƒç”¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚è¿™æ˜¯ä»–ä¸æ™®é€šæ„é€ å‡½æ•°çš„ä¸€ä¸ªä¸»è¦åŒºåˆ«ï¼Œåè€…ä¸éœ€è¦newä¹Ÿå¯ä»¥æ‰§è¡Œã€‚
> 
> - ç±»çš„æ‰€ä»¥å®ä¾‹å…±äº«ä¸€ä¸ªåŸå‹å˜é‡ã€‚
> 
> - ç±»çš„å†…éƒ¨ï¼Œé»˜è®¤æ˜¯ä¸¥æ ¼æ¨¡å¼

## æ›´ç®€æ´çš„è®¾è®¡

æˆ‘ä»¬å¯ä»¥åŸºäºè¡Œä¸ºå§”æ‰˜æœºåˆ¶ï¼Œä½¿è¿™ä¸ªè¿‡ç¨‹å˜å¾—æ›´ç›´æ¥ï¼Œæ˜äº†ã€‚

```javascript
let father = {
  init(name) {
    this.name = name;
  },
  dance() {
    return 'dancing';
  },
};

let son = {
  singAndDance() {
    console.log(this.name + ' sing and' + this.dance());
  },
};

Object.setPrototypeOf(son, father);
son.init('son')
son.singAndDance()
```

è¯´åˆ°åº•ï¼ŒåŸºäºç±»çš„å®ç°åˆ°æœ€ååˆ›å»ºå‡ºæ¥çš„ä¹Ÿæ˜¯å¯¹è±¡ï¼Œåªä¸è¿‡å°†è¿‡ç¨‹æŠ½è±¡æˆçˆ¶ç±»å­ç±»çš„å½¢å¼ã€‚å½“ä½¿ç”¨å¯¹è±¡æ¥è¿›è¡Œè®¾è®¡ä»£ç æ—¶ï¼Œè¯­æ³•æ›´åŠ ç®€æ˜ï¼Œç»“æ„æ›´åŠ æ¸…æ™°ã€‚

> è¡Œä¸ºå§”æ‰˜è®¤ä¸ºï¼Œå¯¹è±¡ä¹‹é—´æ˜¯å…„å¼Ÿå…³ç³»ï¼Œäº’ç›¸å§”æ‰˜ï¼Œè€Œä¸æ˜¯çˆ¶ç±»å’Œå­ç±»çš„å…³ç³»ï¼ŒJavaScriptä¸­çš„`[[prototype]]`æœ¬è´¨ä¸Šå°±æ˜¯è¡Œä¸ºå§”æ‰˜æœºåˆ¶ã€‚
> 
> å¯¹è±¡å…³è”å€¡å¯¼ç›´æ¥åˆ›å»ºå’Œå…³è”å¯¹è±¡ï¼Œä¸æŠŠå®ƒä»¬æŠ½è±¡æˆç±»ã€‚å¯¹è±¡å…³è”å¯ä»¥åŸºäº`[[prototype]]`çš„è¡Œä¸ºå§”æ‰˜éå¸¸è‡ªç„¶çš„å®ç°
> 
> â€”â€”ã€Šä½ ä¸çŸ¥é“çš„JavaScriptã€‹ä¸Šå†Œ

## åŸå‹é“¾æ¢³ç†

```js
function Person(name) {
    this.name = name
}
var p2 = new Person('king');
console.log(p2.__proto__) //Person.prototype
console.log(p2.__proto__.__proto__) //Object.prototype
console.log(p2.__proto__.__proto__.__proto__) // null
console.log(p2.__proto__.__proto__.__proto__.__proto__)//nullåé¢æ²¡æœ‰äº†ï¼ŒæŠ¥é”™
console.log(p2.__proto__.__proto__.__proto__.__proto__.__proto__)//nullåé¢æ²¡æœ‰äº†ï¼ŒæŠ¥é”™
console.log(p2.constructor)//Person
console.log(p2.prototype)//undefined p2æ˜¯å®ä¾‹ï¼Œæ²¡æœ‰prototypeå±æ€§
console.log(Person.constructor)//Function ä¸€ä¸ªç©ºå‡½æ•°
console.log(Person.prototype)//æ‰“å°å‡ºPerson.prototypeè¿™ä¸ªå¯¹è±¡é‡Œæ‰€æœ‰çš„æ–¹æ³•å’Œå±æ€§
console.log(Person.prototype.constructor)//Person
console.log(Person.prototype.__proto__)// Object.prototype
console.log(Person.__proto__) //Function.prototype
console.log(Function.prototype.__proto__)//Object.prototype
console.log(Function.__proto__)//Function.prototype
console.log(Object.__proto__)//Function.prototype
console.log(Object.prototype.__proto__)//null
```