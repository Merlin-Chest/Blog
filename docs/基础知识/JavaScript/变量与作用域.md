# å˜é‡ä¸ä½œç”¨åŸŸ

## åŸå§‹å€¼ä¸å¼•ç”¨å€¼

ä¿å­˜åŸå§‹å€¼ï¼ˆ6ç§ï¼‰çš„å˜é‡æ˜¯æŒ‰å€¼è®¿é—®çš„ï¼Œä¿å­˜å¼•ç”¨å€¼ï¼ˆå¯¹è±¡ï¼‰çš„å˜é‡æ˜¯æŒ‰å¼•ç”¨è®¿é—®çš„ã€‚

- æ•°æ®å­˜å‚¨ä½ç½®
	- å€¼å­˜å‚¨â€”â€”æ ˆ
	- å¼•ç”¨å­˜å‚¨â€”â€”å¼•ç”¨ä¿¡æ¯å­˜å‚¨åœ¨æ ˆï¼Œå†…å®¹å­˜å‚¨åœ¨å †
- åŸå› 
	- åŸºæœ¬ç±»å‹å¤§å°å›ºå®šï¼Œå ç”¨ç©ºé—´å°
	- å¼•ç”¨ç±»å‹å¤§å°ä¸å›ºå®šï¼Œå½±å“æ€§èƒ½

> åŸå§‹å€¼ä¸èƒ½æœ‰å±æ€§ï¼Œå°½ç®¡å°è¯•ç»™åŸå§‹å€¼æ·»åŠ å±æ€§ä¸ä¼šæŠ¥é”™ã€‚

å¯¹äºåŸå§‹å€¼å’Œå¼•ç”¨å€¼çš„å¤åˆ¶å…¶å®éƒ½æ˜¯å€¼å¤åˆ¶ï¼Œä½†åŸå§‹å€¼æ˜¯å¤åˆ¶å€¼æœ¬èº«ï¼Œå¼•ç”¨å€¼å¤åˆ¶çš„æ˜¯å€¼å­˜å‚¨çš„ä½ç½®ï¼Œä»ç„¶æ˜¯å¼•ç”¨åŒä¸ªå¯¹è±¡ã€‚

å‡½æ•°ä¼ å‚åªæœ‰æŒ‰å€¼ä¼ é€’ï¼Œä¸ç®¡æ˜¯åŸå§‹å€¼è¿˜æ˜¯å¼•ç”¨å€¼ã€‚

```js
let obj = {};
function setName(obj){
	// åœ°å€1çš„obj
	obj.name = 'obj1';
	// ç”Ÿæˆåœ°å€2çš„objï¼Œå¹¶èµ‹å€¼ç»™objå˜é‡ï¼ŒåŸæ¥çš„æŒ‡å‘è¿˜æ˜¯æ²¡æœ‰æ”¹å˜ã€‚
	obj = new Object();
	obj.name = 'obj2'
}
setName(obj);

console.log(obj.name) // 'obj1'
```


## å‡ ä¸ªæ¦‚å¿µ

- å¼•æ“ï¼šä»å¤´åˆ°å°¾è´Ÿè´£æ•´ä¸ªJavaScriptç¨‹åºçš„ç¼–è¯‘å’Œæ‰§è¡Œè¿‡ç¨‹ã€‚
- ç¼–è¯‘å™¨ï¼šè´Ÿè´£è¯­æ³•åˆ†æåŠä»£ç ç”Ÿæˆçš„å†…å®¹ã€‚
- æ‰§è¡Œä¸Šä¸‹æ–‡ï¼šå…³è”ç€ä¸€ä¸ªå˜é‡å¯¹è±¡ï¼ŒåŒ…å«åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡å®šä¹‰çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°ã€‚
	- å…¨å±€ä¸Šä¸‹æ–‡ï¼ˆwindowså¯¹è±¡ï¼‰å°±æ˜¯æœ€å¤–å±‚çš„ä¸Šä¸‹æ–‡ï¼Œletæˆ–constå£°æ˜çš„ä¸ä¼šå®šä¹‰åœ¨å…¨å±€ä¸Šä¸‹æ–‡ä¸­ï¼Œä½†ä½œç”¨åŸŸé“¾çš„è§£æç»“æœæ˜¯ä¸€æ ·çš„
	- å½“å‡½æ•°è¿›å…¥æ‰§è¡Œæµæ—¶ï¼Œå‡½æ•°çš„ä¸Šä¸‹æ–‡ä¼šè¢«æ¨è¿›ä¸€ä¸ªä¸Šä¸‹æ–‡æ ˆä¸­ã€‚
- ä½œç”¨åŸŸï¼šè´Ÿè´£æ”¶é›†å’Œç»´æŠ¤æ‰€æœ‰å£°æ˜çš„å˜é‡ç»„æˆçš„**æŸ¥è¯¢**ï¼Œå¹¶å®æ–½ä¸€å¥—ä¸¥æ ¼çš„è§„åˆ™æ¥æ§åˆ¶å½“å‰æ‰§è¡Œä»£ç å¯¹å˜é‡çš„è®¿é—®æƒé™ã€‚
- ä½œç”¨åŸŸé“¾ï¼šå†³å®šå„çº§ä¸Šä¸‹æ–‡è®¿é—®å˜é‡å’Œå‡½æ•°çš„é¡ºåºã€‚åœ¨å‡½æ•°å®šä¹‰çš„æ—¶å€™å·²ç»ç¡®å®šï¼Œåœ¨å‡½æ•°å¯¹è±¡ä¸­çš„scopedå±æ€§ä¸­ï¼Œå…·ä½“å†…å®¹å–å†³äºå®šä¹‰çš„æ‰€åœ¨çš„ä½ç½®ã€‚

### å¼•æ“

æŸ¥è¯¢æ ‡è¯†ç¬¦ï¼Œåˆ†ä¸ºLHSæŸ¥è¯¢å’ŒRHSæŸ¥è¯¢ï¼š

- LHSï¼šæ‰¾åˆ°æŸä¸ªå˜é‡çš„å®¹å™¨æœ¬èº«ï¼Œå¹¶å¯¹å®ƒèµ‹å€¼
  - ä¾‹å¦‚åœ¨ç¬¬ä¸€ä¸ªğŸŒ°ä¸­ï¼Œ`a = 2` å°±æ˜¯ä¸€ä¸ªLHSæŸ¥è¯¢
- RHSï¼šæŸ¥æ‰¾æŸä¸ªå˜é‡ï¼Œè·å–å®ƒçš„å€¼
  - ä¾‹å¦‚ `console.log(a)` å°±æ˜¯ä¸€ä¸ªRSHæŸ¥è¯¢

### ç¼–è¯‘å™¨

ç¼–è¯‘è¿‡ç¨‹ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š

- è¯æ³•åˆ†æï¼šå°†å­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²åˆ†è§£ä¸ºä»£ç å—ï¼ˆè¯ç»„å•å…ƒï¼‰
- è¯­æ³•åˆ†æï¼šå°†è¯ç»„å•å…ƒæµè½¬åŒ–ä¸ºASTæ ‘ï¼ˆæŠ½è±¡è¯­æ³•ğŸŒ²ï¼‰
- ä»£ç ç”Ÿæˆï¼šå°†ASTæ ‘è½¬åŒ–ä¸ºæœºå™¨å¯æ‰§è¡Œçš„ä»£ç ã€‚

> ä¸¾ç¬¬ä¸€ä¸ªğŸŒ°ï¼š`var a  = 1 ;`
>
> å˜é‡çš„èµ‹å€¼æ“ä½œï¼Œå®é™…ä¸Šåˆ†ä¸ºä¸¤æ­¥ï¼š
>
> 1. ç¼–è¯‘å™¨ä¼šåœ¨å½“å‰çš„ä½œç”¨åŸŸä¸­å£°æ˜ä¸€ä¸ªå˜é‡ï¼ˆå¦‚æœæ²¡å£°æ˜è¿‡ï¼‰ï¼Œä¹Ÿå°±æ˜¯ `var a` ;
> 2. åœ¨è¿è¡Œæ—¶ï¼Œå¼•æ“ä¼šåœ¨ä½œç”¨åŸŸä¸­æŸ¥æ‰¾è¯¥å˜é‡ï¼Œå¦‚æœèƒ½æ‰¾åˆ°å°±è¿›è¡Œèµ‹å€¼ï¼Œä¹Ÿå°±æ˜¯ `a = 2`ï¼Œæ‰¾ä¸åˆ°å°±ä¼šæŠ¥é”™ã€‚

## è¯æ³•ä½œç”¨åŸŸ

- **è¯æ³•ä½œç”¨åŸŸ**ï¼ˆ`Lexical Scopes`ï¼‰æ˜¯ `javascript` ä¸­ä½¿ç”¨çš„ä½œç”¨åŸŸç±»å‹ï¼Œ**è¯æ³•ä½œç”¨åŸŸ** ä¹Ÿå¯ä»¥è¢«å«åš **é™æ€ä½œç”¨åŸŸ**ï¼Œä¸ä¹‹ç›¸å¯¹çš„è¿˜æœ‰ **åŠ¨æ€ä½œç”¨åŸŸ**ï¼ˆbashè¯­è¨€ä½¿ç”¨ï¼‰ã€‚
- è¯æ³•ä½œç”¨åŸŸä¸ºå‡½æ•°å®šä¹‰æ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸã€‚
- **æ— è®ºå‡½æ•°åœ¨å“ªé‡Œï¼Œåœ¨ä½•æ—¶è¢«è°ƒç”¨ï¼Œå®ƒçš„è¯æ³•ä½œç”¨åŸŸéƒ½åªåœ¨å‡½æ•°è¢«å£°æ˜æ—¶æ‰€å¤„çš„ä½ç½®å†³å®šã€‚**

#### ä¾‹å­
```js
var a = 3;
function c(){
	alert(a);
}
(function(){
	var a = 4;
	c();
})();
```

> jsä¸­å˜é‡çš„ä½œç”¨åŸŸé“¾ä¸å®šä¹‰æ—¶çš„ç¯å¢ƒæœ‰å…³ï¼Œä¸æ‰§è¡Œæ—¶æ— å…³ã€‚

### æ¬ºéª—è¯æ³•ï¼ˆä¸æ¨èä½¿ç”¨ï¼‰
- eval(..)å‡½æ•°
  - é€šå¸¸è¢«ç”¨æ¥æ‰§è¡ŒåŠ¨æ€åˆ›å»ºçš„ä»£ç 
  - æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ’å…¥çš„å­—ç¬¦ä¸²ä¼šè¢«å½“åšåŸæœ¬å°±åœ¨é‚£é‡Œä¸€æ ·æ¥å¤„ç†ã€‚
  - **å¯èƒ½å¯¹åŸæœ¬çš„è¯æ³•ä½œç”¨åŸŸè¿›è¡Œäº†ä¿®æ”¹**ã€‚
- with å…³é”®å­—
  - é€šå¸¸è¢«å½“åšé‡å¤å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡çš„å¤šä¸ªå±æ€§å¿«æ·æ–¹å¼ï¼Œå¯ä»¥ä¸ç”¨é‡å¤å¼•ç”¨å¯¹è±¡æœ¬èº«

```js
var obj = {
  a: 1,
  b: 2,
  c: 3
}
with(obj) {
  a = 3;
  b = 4;
  c = 5;
}
```

  - withå£°æ˜å®é™…ä¸Šæ˜¯æ ¹æ®ä¼ é€’çš„å¯¹è±¡ï¼Œå‡­ç©ºåˆ›å»ºäº†ä¸€ä¸ªå…¨æ–°çš„è¯æ³•ä½œç”¨åŸŸï¼Œå½“å¯¹è±¡ä¸­çš„æ ‡è¯†ç¬¦åœ¨å…¨å±€ä½œç”¨åŸŸä¹Ÿæ‰¾ä¸åˆ°æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå…¨å±€å˜é‡ã€‚

## å‡½æ•°ä½œç”¨åŸŸ

å±äºè¿™ä¸ªå‡½æ•°çš„å…¨éƒ¨å˜é‡éƒ½å¯ä»¥åœ¨æ•´ä¸ªå‡½æ•°çš„èŒƒå›´å†…ä½¿ç”¨åŠå¤ç”¨ã€‚

- åœ¨å¤–éƒ¨ä½¿ç”¨ä¸€ä¸ªå‡½æ•°åŒ…è£¹ï¼Œå¯ä»¥éšè—å†…éƒ¨å®ç°ã€‚
- è§„é¿å†²çª
  - ä½¿ç”¨å…¨å±€å‘½åç©ºé—´
  - ä½¿ç”¨æ¨¡å—ç®¡ç†
- `(function fn(){...})`ä½œä¸ºå‡½æ•°è¡¨è¾¾å¼ï¼Œè¯´æ˜fooåªèƒ½åœ¨...æ‰€ä»£è¡¨çš„ä½ç½®ä¸­è¢«è®¿é—®ï¼Œå¤–éƒ¨ä½œç”¨åŸŸåˆ™ä¸è¡Œï¼Œä¸ä¼šæ±¡æŸ“å¤–éƒ¨ä½œç”¨åŸŸã€‚
- åŒ¿åå‡½æ•°è¡¨è¾¾å¼å’Œå…·åå‡½æ•°è¡¨è¾¾å¼
  - åŒ¿åçš„ç¼ºç‚¹
    - åœ¨æ ˆè¿½è¸ªä¸­ä¸ä¼šæ˜¾ç¤ºæœ‰æ„ä¹‰çš„å‡½æ•°åï¼Œè°ƒè¯•å›°éš¾
    - ä¸æ–¹ä¾¿è‡ªèº«å¼•ç”¨
    - ä»£ç å¯è¯»æ€§å·®
- ç«‹å³æ‰§è¡Œå‡½æ•°è¡¨è¾¾å¼ï¼ˆIIFEï¼‰
  - `(function(){})()`
  - ç”¨æ³•
    - é€šè¿‡å‡½æ•°ä½œç”¨åŸŸè§£å†³å‘½åå†²çª
    - æŠŠä»–ä»¬å½“åšå‡½æ•°è°ƒç”¨å¹¶ä¼ é€’å‚æ•°è¿›å»
    - å€’ç½®ä»£ç çš„è¿è¡Œæ•°æ®

## ä½œç”¨åŸŸåµŒå¥—

- å®é™…æƒ…å†µä¸­ï¼Œé€šå¸¸éœ€è¦åŒæ—¶é¡¾åŠå‡ ä¸ªä½œç”¨åŸŸã€‚åœ¨å½“å‰ä½œç”¨åŸŸæ‰¾ä¸åˆ°æ—¶ï¼Œå¼•æ“å°±ä¼šæ²¿ç€ä½œç”¨åŸŸé“¾åœ¨å¤–å±‚åµŒå¥—çš„ä½œç”¨åŸŸä¸­ç»§ç»­æŸ¥æ‰¾ï¼Œç›´åˆ°åœ¨å…¨å±€ä½œç”¨åŸŸä¹Ÿæ‰¾ä¸åˆ°æ—¶ï¼ŒæŸ¥æ‰¾åœæ­¢ã€‚
- ä½œç”¨åŸŸä¸­çš„å¯¹è±¡ä¹Ÿæœ‰ä¸€ä¸ªåŸå‹é“¾ï¼Œå› æ­¤æœç´¢å¯èƒ½è®¾è®¡æ¯ä¸ªå¯¹è±¡çš„åŸå‹é“¾ã€‚

å¯èƒ½å‘ç”Ÿçš„ä¸¤ç§å¼‚å¸¸ç±»å‹ï¼š
- ReferenceErrorï¼šä½œç”¨åŸŸåˆ¤åˆ«å¤±è´¥ç›¸å…³
- TypeErrorï¼šä½œç”¨åŸŸåˆ¤åˆ«æˆåŠŸï¼Œä½†å¯¹ç»“æœçš„æ“ä½œæ˜¯ä¸åˆæ³•çš„ã€‚

## å˜é‡å£°æ˜

### var
- å˜é‡æå‡
	- å‡ºç°å˜é‡æå‡æ˜¯å› ä¸ºJsçš„æ‰§è¡Œæœºåˆ¶æ˜¯ **å…ˆç¼–è¯‘å†æ‰§è¡Œ** ã€‚
	- åœ¨ç¼–è¯‘é˜¶æ®µï¼Œå˜é‡å’Œå‡½æ•°ä¼šè¢«å­˜æ”¾åˆ°å˜é‡ç¯å¢ƒä¸­ï¼Œå˜é‡çš„é»˜è®¤å€¼ä¼šè¢«è®¾ç½®ä¸ºundefinedï¼›åœ¨ä»£ç æ‰§è¡Œé˜¶æ®µï¼ŒJavaScript å¼•æ“ä¼šä»å˜é‡ç¯å¢ƒä¸­å»æŸ¥æ‰¾è‡ªå®šä¹‰çš„å˜é‡å’Œå‡½æ•°ã€‚
	- å¯¹äºåŒåå‡½æ•°å’Œå˜é‡çš„å¤„ç†
		- å¦‚æœæ˜¯åŒåçš„å‡½æ•°ï¼ŒJavaScriptç¼–è¯‘é˜¶æ®µä¼šé€‰æ‹©æœ€åå£°æ˜çš„é‚£ä¸ªã€‚ 
		- å¦‚æœå˜é‡å’Œå‡½æ•°åŒåï¼Œé‚£ä¹ˆåœ¨ç¼–è¯‘é˜¶æ®µï¼Œå˜é‡çš„å£°æ˜ä¼šè¢«å¿½ç•¥ã€‚ï¼ˆå‡½æ•°æå‡ä¼˜å…ˆäºå˜é‡æå‡ï¼‰
	- å‡½æ•°æå‡ä¼šæŠŠæ•´ä¸ªå‡½æ•°æŒªåˆ°ä½œç”¨åŸŸé¡¶éƒ¨ï¼Œå˜é‡æå‡åªä¼šæŠŠå£°æ˜æŒªåˆ°ä½œç”¨åŸŸé¡¶éƒ¨
	- æ¯ä¸ªä½œç”¨åŸŸéƒ½ä¼šè¿›è¡Œæå‡æ“ä½œã€‚
	- é‡å¤çš„varå£°æ˜ä¼šè¢«å¿½ç•¥

#### ä¾‹å­
```js
(function(){
   var x = y = 1;
})();
var z;

console.log(y); // 1
console.log(z); // undefined
console.log(x); // Uncaught ReferenceError: x is not defined
```

> var x = y = 1; å®é™…ä¸Šè¿™é‡Œæ˜¯ä»å³å¾€å·¦æ‰§è¡Œçš„ï¼Œé¦–å…ˆæ‰§è¡Œy = 1, å› ä¸ºyæ²¡æœ‰ä½¿ç”¨varå£°æ˜ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œç„¶åç¬¬äºŒæ­¥æ˜¯å°†yèµ‹å€¼ç»™xï¼Œè®²ä¸€ä¸ªå…¨å±€å˜é‡èµ‹å€¼ç»™äº†ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œæœ€ç»ˆï¼Œxæ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œyæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œæ‰€ä»¥æ‰“å°xæ˜¯æŠ¥é”™ã€‚

```js
function a() {
    var temp = 10;
    function b() {
        console.log(temp); // 10
    }
    b();
}
a();

function a() {
    var temp = 10;
    b();
}
function b() {
    // æŠ¥é”™ Uncaught ReferenceError: temp is not defined
    console.log(temp);
}
a();
```

> ç¬¬äºŒä¸ªå‡½æ•°aä¼šè¦†ç›–ç¬¬ä¸€ä¸ªå‡½æ•°aï¼Œbå‡½æ•°ä¸­tempæ˜¯å…¨å±€ä¸­çš„tempå˜é‡ï¼Œæ²¡æœ‰å®šä¹‰ï¼Œæ‰€ä»¥ä¸ºundefined

```js
f = function() {return true;};   
g = function() {return false;};   
(function() {
   if (g() && [] == ![]) {   
      f = function f() {return false;};
      // function g() {return true;}  
      // å¦‚æœæ”¾åœ¨æ­¤å¤„ä¼šæŠ¥é”™ï¼šUncaught TypeError: g is not a function
      // æ”¾åœ¨æ­¤å¤„ã€‚å‡½æ•°å£°æ˜ä¼šæå‰ï¼Œä½†æ˜¯å‡½æ•°ä½“ä¸ä¼šæå‰ï¼Œä¸ºundefined
   }
   function g() {return true;} // æ”¾åœ¨æ­¤å¤„ï¼Œå‡½æ•°å£°æ˜ä¼šæå‰
})();
console.log(g()); // false
console.log(f()); // false
```

> 1. è‡ªæ‰§è¡Œå‡½æ•°å†…ï¼Œå‡½æ•°ä¸ä¼šè¦†ç›–å¤–é¢çš„å‡½æ•°
> 2. `[] == ![]`ï¼šé¦–å…ˆ`![]`ä¼šè½¬åŒ–ä¸º`!true`ï¼Œä¸º`false`ï¼Œä¸º`0`ï¼Œè€Œå·¦è¾¹`[]`ä¼šè¢«æ±‚å€¼ï¼Œä¸º`''`ï¼Œä¸º`0`ï¼Œæ‰€ä»¥æ¡ä»¶æˆç«‹ã€‚

### letå’Œconst

ç”¨äºå®šä¹‰å—ä½œç”¨åŸŸï¼Œç®€å•æ¥è¯´ï¼ŒèŠ±æ‹¬å·å†… `{...}` çš„åŒºåŸŸå°±æ˜¯å—çº§ä½œç”¨åŸŸåŒºåŸŸã€‚
- é‡å¤çš„letå£°æ˜ä¼šæŠ¥é”™SyntaxError
- ä¸¥æ ¼æ¥è®²ï¼Œletåœ¨è¿è¡Œæ—¶ä¹Ÿä¼šè¢«æå‡ï¼Œä½†ç”±äºå­˜åœ¨**æš‚æ—¶æ€§æ­»åŒº**ï¼Œæ‰€ä»¥å®é™…ä¸­ä¸èƒ½åœ¨å£°æ˜ä¹‹å‰ä½¿ç”¨ã€‚
	- æš‚æ—¶æ€§æ­»åŒºï¼šç”¨let/constå£°æ˜çš„å˜é‡ä¼šå…ˆåœ¨ä½œç”¨åŸŸä¸­è¢«åˆ›å»ºå‡ºæ¥ï¼Œä½†å› æ­¤æ—¶è¿˜æœªè¿›è¡Œè¯æ³•ç»‘å®šï¼Œæ‰€ä»¥æ˜¯ä¸èƒ½è¢«è®¿é—®çš„ï¼Œå¦‚æœè®¿é—®å°±ä¼šæŠ›å‡ºé”™è¯¯ã€‚å› æ­¤ï¼Œåœ¨è¿™è¿è¡Œæµç¨‹è¿›å…¥ä½œç”¨åŸŸåˆ›å»ºå˜é‡ï¼Œåˆ°å˜é‡å¯ä»¥è¢«è®¿é—®ä¹‹é—´çš„è¿™ä¸€æ®µæ—¶é—´ï¼Œå°±ç§°ä¹‹ä¸ºæš‚æ—¶æ€§æ­»åŒºã€‚
- constå£°æ˜åªåº”ç”¨äºé¡¶å±‚å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå£°æ˜å¯¹è±¡ï¼Œå¯¹è±¡çš„å±æ€§è¿˜æ˜¯å¯ä»¥ä¿®æ”¹çš„ã€‚
	- v8ä¼˜åŒ–ï¼šè¿è¡Œæ—¶ç¼–è¯‘å™¨ä¼šå°†æ‰€æœ‰å®ä¾‹éƒ½æ›¿æ¢æˆå®é™…çš„å€¼ï¼Œè€Œä¸ä¼šé€šè¿‡æŸ¥è¯¢è¡¨è¿›è¡Œå˜é‡çš„æŸ¥è¯¢ã€‚

## é—­åŒ…

### ä»€ä¹ˆæ˜¯é—­åŒ…

å‡½æ•° A å†…éƒ¨æœ‰â¼€ä¸ªå‡½æ•° Bï¼Œå‡½æ•° B å¯ä»¥è®¿ é—®åˆ°å‡½æ•° A ä¸­çš„å˜é‡ï¼Œé‚£ä¹ˆå‡½æ•° B å°±æ˜¯é—­åŒ…

### å½¢æˆé—­åŒ…çš„åŸå› 

å†…éƒ¨å‡½æ•°å¼•ç”¨å¤–éƒ¨ä½œç”¨åŸŸçš„å˜é‡

## jså¦‚ä½•å®ç°é—­åŒ…

```js
var scope = "global scope";
function checkscope(){
    var scope = "local scope";
    function f(){
        return scope;
    }
    return f;
}

var foo = checkscope();
foo();
```

æˆ‘ä»¬çŸ¥é“ f æ‰§è¡Œä¸Šä¸‹æ–‡ç»´æŠ¤äº†ä¸€ä¸ªä½œç”¨åŸŸé“¾ï¼š

```bash
fContext = {
    Scope: [AO, checkscopeContext.AO, globalContext.VO],
}
```

å°±æ˜¯å› ä¸ºè¿™ä¸ªä½œç”¨åŸŸé“¾ï¼Œf å‡½æ•°ä¾ç„¶å¯ä»¥è¯»å–åˆ° `checkscopeContext.AO` çš„å€¼ï¼Œè¯´æ˜å½“ f å‡½æ•°å¼•ç”¨äº† `checkscopeContext.AO` ä¸­çš„å€¼çš„æ—¶å€™ï¼Œå³ä½¿ `checkscopeContext` è¢«é”€æ¯äº†ï¼Œä½†æ˜¯ JavaScript ä¾ç„¶ä¼šè®© `checkscopeContext.AO` æ´»åœ¨å†…å­˜ä¸­ï¼Œf å‡½æ•°ä¾ç„¶å¯ä»¥é€šè¿‡ f å‡½æ•°çš„ä½œç”¨åŸŸé“¾æ‰¾åˆ°å®ƒï¼Œæ­£æ˜¯å› ä¸º JavaScript åšåˆ°äº†è¿™ä¸€ç‚¹ï¼Œä»è€Œå®ç°äº†é—­åŒ…è¿™ä¸ªæ¦‚å¿µã€‚

### é—­åŒ…çš„ä½œç”¨

- ä¿æŠ¤å‡½æ•°çš„ç§æœ‰å˜é‡ä¸å—å¤–éƒ¨çš„å¹²æ‰°ã€‚å½¢æˆä¸é”€æ¯çš„æ ˆå†…å­˜ã€‚
- ä¿å­˜ï¼ŒæŠŠä¸€äº›å‡½æ•°å†…çš„å€¼ä¿å­˜ä¸‹æ¥ã€‚é—­åŒ…å¯ä»¥å®ç°æ–¹æ³•å’Œå±æ€§çš„ç§æœ‰åŒ–ã€‚

### é—­åŒ…çš„åœºæ™¯

1. returnä¸€ä¸ªå‡½æ•°

```js
var n = 10
function fn(){
    var n =20
    function f() {
       n++;
       console.log(n)
     }
    return f
}

var x = fn()
x() // 21
```

> fn()å°±æ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œå­˜åœ¨ä¸Šçº§ä½œç”¨åŸŸçš„å¼•ç”¨ï¼Œå³ n = 20ï¼Œè¾“å‡ºç»“æœä¸º21

2ã€å‡½æ•°ä½œä¸ºå‚æ•°

```js
var a = 'merlin'
function foo(){
    var a = 'foo'
    function fo(){
        console.log(a)
    }
    return fo
}

function f(p){
    var a = 'f'
    p()
}
f(foo())
/* è¾“å‡º
*   foo
/ 
```

> fo()å°±æ˜¯é—­åŒ…ï¼Œå­˜åœ¨ä¸Šçº§ä½œç”¨åŸŸçš„å¼•ç”¨ï¼Œå³a = 'foo'ï¼Œconsole.logÂ ç»“æœä¸ºfoo

3ã€è‡ªæ‰§è¡Œå‡½æ•°

```js
var n = 'merlin';
(function p(){
    console.log(n)
})()
/* è¾“å‡º
*   merlin
/ 
```

> åŒæ ·å­˜åœ¨ä¸Šçº§ä½œç”¨åŸŸçš„å¼•ç”¨ï¼Œå³n = 'merlin'ï¼Œconsole.log ç»“æœä¸ºmerlin

4ã€å¾ªç¯èµ‹å€¼

```js
for(var i = 0; i<10; i++){
  (function(j){
     setTimeout(function(){
      console.log(j)
      }, 1000) 
  })(i)
}
```

> å› ä¸ºå­˜åœ¨é—­åŒ…ï¼Œæ‰€ä»¥èƒ½ä¾æ¬¡è¾“å‡º0-9ï¼Œé—­åŒ…å½¢æˆäº†10ä¸ªäº’ä¸å¹²æ‰°çš„ç§æœ‰ä½œç”¨åŸŸã€‚æ¯ä¸ªä½œç”¨åŸŸé‡Œçš„iéƒ½ä¸åŒ
>
> å¦‚æœå»æ‰è‡ªæ‰§è¡Œå‡½æ•°ï¼Œå°±ä¸å­˜åœ¨å¤–éƒ¨ä½œç”¨åŸŸçš„å¼•ç”¨ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªsetTimeoutè°ƒç”¨çš„éƒ½æ˜¯å…¨å±€çš„iã€‚
>
> ç”±äºjsæ˜¯å•çº¿ç¨‹çš„ï¼Œé‡åˆ°å¼‚æ­¥ä»£ç ä¼šå…ˆå…¥æ ˆï¼Œä¸å…ˆæ‰§è¡Œï¼Œç­‰åˆ°åŒæ­¥ä»£ç æ‰§è¡Œå®Œåæ‰æ‰§è¡Œï¼Œæ­¤æ—¶çš„å…¨å±€iä¸º10ï¼Œæ‰€ä»¥è¾“å…¥çš„ä¸º10ä¸ª10

5ã€å›è°ƒå‡½æ•°

```js
window.name = 'merlin';
setTimeout(function timeHandler(){
  console.log(window.name);
}, 100);
```

### é—­åŒ…éœ€è¦æ³¨æ„ä»€ä¹ˆ

> å®¹æ˜“å¯¼è‡´å†…å­˜æ³„æ¼ã€‚é—­åŒ…ä¼šæºå¸¦åŒ…å«å…¶å®ƒçš„å‡½æ•°ä½œç”¨åŸŸï¼Œå› æ­¤ä¼šæ¯”å…¶ä»–å‡½æ•°å ç”¨æ›´å¤šçš„å†…å­˜ã€‚
>
> è¿‡åº¦ä½¿ç”¨é—­åŒ…ä¼šå¯¼è‡´å†…å­˜å ç”¨è¿‡å¤šï¼Œæ‰€ä»¥è¦è°¨æ…ä½¿ç”¨é—­åŒ…ã€‚

### ä¾‹å­
```js
function fun(n, o) {
  console.log(o)
  return {
    fun: function(m){
      return fun(m, n);
    }
  };
}
var a = fun(0);  a.fun(1);  a.fun(2);  a.fun(3);
// a: {fun:function(m){ return fn(m, 0); }}
var b = fun(0).fun(1).fun(2).fun(3);
// b: {fun:function(m){ return fn(m, 0); }}
// b: {fun:function(m){ return fn(m, 1); }}
// b: {fun:function(m){ return fn(m, 2); }}
var c = fun(0).fun(1);  c.fun(2);  c.fun(3);
// b: {fun:function(m){ return fn(m, 0); }}
// b: {fun:function(m){ return fn(m, 1); }}
```